<!DOCTYPE html><head><meta charset="UTF-8"><title>SolutionInvalidity | Ferret</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Ferret</a><a href="https://github.com/mangerij/ferret" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="6e14445e-63c2-42a1-829b-28018d62f956" data-constrainWidth="false">Get Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="4a597cc5-e0c9-435b-8b0b-d10da266657e" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="2e1ab23c-aded-4d2b-ba64-c81ef1cc7290" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="93c06167-0253-41b1-be11-5b9f2492271d" data-constrainWidth="false">EU Horizon2020-IF<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../publication_highlights/publication_highlights.html">Highlights</a></li><li><a href="#!" class="dropdown-trigger" data-target="a319cfee-bdc9-4b4c-8fb7-7af37367c6b7" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contact</a></li></ul><a href="#" class="sidenav-trigger" data-target="eeeab958-118a-483e-b1b3-7375bb64a5c7"><i class="material-icons">menu</i></a><ul class="sidenav" id="eeeab958-118a-483e-b1b3-7375bb64a5c7"><li><a href="#!" class="dropdown-trigger" data-target="2ec8a93b-66c9-4409-97bf-3f46d629cc0d" data-constrainWidth="false">Get Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="3edc8fe5-53be-460f-a3af-3f9382b1cad2" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="e0a9744c-effd-4b84-908b-eb36c5092377" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="55cf72ec-492e-4358-be3e-caffdf8ea870" data-constrainWidth="false">EU Horizon2020-IF<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../publication_highlights/publication_highlights.html">Highlights</a></li><li><a href="#!" class="dropdown-trigger" data-target="0bde735f-6a92-4fc1-b049-fb3bb269fe6d" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contact</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="6e14445e-63c2-42a1-829b-28018d62f956"><li><a href="../../getting_started/install.html">Install FERRET</a></li><li><a href="../../getting_started/update.html">Update FERRET</a></li><li><a href="../../getting_started/running.html">Running FERRET</a></li><li><a href="../../getting_started/paraview.html">Visualization Tools</a></li><li><a href="../../getting_started/docs.html">Browse the documentation locally</a></li></ul><ul class="dropdown-content" id="4a597cc5-e0c9-435b-8b0b-d10da266657e"><li><a href="../../theory/intro_LGD.html">Phase Field Method of Ferroelectricity (FE)</a></li><li><a href="../../theory/intro_LLG.html">Micromagnetic Simulations</a></li><li><a href="../../theory/intro_piezo.html">Piezoelectricity</a></li><li><a href="../../theory/intro_thermo.html">Thermoelectric Phenomena</a></li><li><a href="../../theory/intro_optical.html">Optical Properties</a></li></ul><ul class="dropdown-content" id="2e1ab23c-aded-4d2b-ba64-c81ef1cc7290"><li><a href="../../tutorials/FE_phase_field_multi_domain.html">Multidomain ferroelectric</a></li><li><a href="../../tutorials/ferroelectric_domain_wall.html">Ferroelectric domain wall</a></li><li><a href="../../tutorials/FE_phase_field_multi_domain_coupled.html">Ferroelectric thin film</a></li><li><a href="../../tutorials/magnetic_ringdown.html">Magnetic ringdown</a></li><li><a href="../../tutorials/AFM_dynamics.html">Antiferromagnetic dynamics</a></li><li><a href="../../tutorials/piezoelectric.html">Piezoelectric actuation</a></li><li><a href="../../tutorials/thermoelectric.html">Polycrystalline thermoelectric transport</a></li></ul><ul class="dropdown-content" id="93c06167-0253-41b1-be11-5b9f2492271d"><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results1.html">Background and model</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results2.html">Summary of key results</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex1.html">Example (ground states)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex2.html">Example (FE DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex3.html">Example (magnetic DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex4.html">Example (ME switching)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex5.html">Example (spin wave transport)</a></li></ul><ul class="dropdown-content" id="a319cfee-bdc9-4b4c-8fb7-7af37367c6b7"><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/ferret_only_syntax.html">FERRET syntax</a></li></ul><ul class="dropdown-content" id="2ec8a93b-66c9-4409-97bf-3f46d629cc0d"><li><a href="../../getting_started/install.html">Install FERRET</a></li><li><a href="../../getting_started/update.html">Update FERRET</a></li><li><a href="../../getting_started/running.html">Running FERRET</a></li><li><a href="../../getting_started/paraview.html">Visualization Tools</a></li><li><a href="../../getting_started/docs.html">Browse the documentation locally</a></li></ul><ul class="dropdown-content" id="3edc8fe5-53be-460f-a3af-3f9382b1cad2"><li><a href="../../theory/intro_LGD.html">Phase Field Method of Ferroelectricity (FE)</a></li><li><a href="../../theory/intro_LLG.html">Micromagnetic Simulations</a></li><li><a href="../../theory/intro_piezo.html">Piezoelectricity</a></li><li><a href="../../theory/intro_thermo.html">Thermoelectric Phenomena</a></li><li><a href="../../theory/intro_optical.html">Optical Properties</a></li></ul><ul class="dropdown-content" id="e0a9744c-effd-4b84-908b-eb36c5092377"><li><a href="../../tutorials/FE_phase_field_multi_domain.html">Multidomain ferroelectric</a></li><li><a href="../../tutorials/ferroelectric_domain_wall.html">Ferroelectric domain wall</a></li><li><a href="../../tutorials/FE_phase_field_multi_domain_coupled.html">Ferroelectric thin film</a></li><li><a href="../../tutorials/magnetic_ringdown.html">Magnetic ringdown</a></li><li><a href="../../tutorials/AFM_dynamics.html">Antiferromagnetic dynamics</a></li><li><a href="../../tutorials/piezoelectric.html">Piezoelectric actuation</a></li><li><a href="../../tutorials/thermoelectric.html">Polycrystalline thermoelectric transport</a></li></ul><ul class="dropdown-content" id="55cf72ec-492e-4358-be3e-caffdf8ea870"><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results1.html">Background and model</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results2.html">Summary of key results</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex1.html">Example (ground states)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex2.html">Example (FE DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex3.html">Example (magnetic DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex4.html">Example (ME switching)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex5.html">Example (spin wave transport)</a></li></ul><ul class="dropdown-content" id="0bde735f-6a92-4fc1-b049-fb3bb269fe6d"><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/ferret_only_syntax.html">FERRET syntax</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="gcse-search"></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="moose-content col s12 m12 l12"><section id="4d88e44b-3f07-4eb6-9983-350cafe1bbaa" data-section-level="1" data-section-text="SolutionInvalidity"><h1 id="solutioninvalidity">SolutionInvalidity</h1><section id="e9e40f89-a55a-41db-b8c7-64f1ccfbab26" data-section-level="2" data-section-text="Description"><h2 id="description">Description</h2><p>The <a href="SolutionInvalidity.html">SolutionInvalidity</a> object holds solution invalid warning information for MOOSE. This object allows you to mark a solution as &quot;invalid&quot; under certain conditions and output in which objects and how many times the conditions occurs. An invalid solution means that the solution somehow does not satisfy requirements, such as a value being out of the bounds of a correlation.  Solutions are allowed to be invalid <em>during</em> the nonlinear solve, but they are not allowed to be invalid once the solve has converged. A &quot;converged&quot; solution that is marked as invalid will cause MOOSE to behave as if the solution did NOT converge - including cutting back timesteps, etc.</p><p>To declare a solution as &quot;invalid&quot;, use the macro in the following code to mark it. The user can provide a message to describe the reason for invalidity:</p><pre class="moose-pre" style="max-height:350px;"><code class="language-cpp">  if (_test_diffusivity &gt; _threshold &amp;&amp; _fe_problem.time() &gt; _invalid_after_time)
  {
    if (!_test_different_procs || processor_id() == 0)
      flagInvalidSolution(&quot;The diffusivity is greater than the threshold value!&quot;);
    if (!_test_different_procs || comm().size() == 1 || processor_id() == 1)
      flagInvalidSolution(&quot;Extra invalid thing!&quot;);
  }
  _diffusivity[_qp] = _test_diffusivity;
}
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#78e4e1ab-a5b0-4b92-a0a4-a7f039ade335">(../moose/test/src/materials/NonsafeMaterial.C)</a><div class="card moose-alert moose-alert-tip"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">school</i><span class="moose-alert-title-brand">tip</span></div><div class="card-content"><div class="moose-alert-content"><p>It is recommended to have a unique message for each invalidity, especially when you want to mark multiple types of invalid solutions within one object.</p></div></div></div><p>If any solution invalidity is detected during the solve, a summary table of solution invalid warnings will be generated and reported at the end of each time step. An example of this output is shown below:</p><pre class="moose-pre"><code class="language-text">
Solution Invalid Warnings:
---------------------------------------------------------------------------------------------------------
|     Object      | Converged | Timestep | Total |                        Message                       |
---------------------------------------------------------------------------------------------------------
| NonsafeMaterial |        16 |       64 |    64 | The diffusivity is greater than the threshold value! |
| NonsafeMaterial |        16 |       64 |    64 | Extra invalid thing!                                 |
---------------------------------------------------------------------------------------------------------
</code></pre><ol class="browser-default" start="1"><li><p><em>Object</em>: shows the moose object name registered for the solution invalid detection and an optional description </p></li><li><p><em>Converged</em>: shows the number of solution invalid warnings for the latest iteration, at convergence </p></li><li><p><em>Timestep</em>: shows the number of solution invalid warnings for the latest time step over all iterations </p></li><li><p><em>Total</em>: shows the total number of solution invalid warnings for the entire simulation </p></li><li><p><em>Message</em>: shows the description of the solution invalidity</p></li></ol><p>When the solution is converged, the number of solution invalid warnings is reported for the latest iteration (linear/nonlinear), the last time step (over all solver iterations) and the entire simulation. SolutionInvalidity warnings can come from numerous objects, some executed once and some executed on every quadrature point. The number of occurrences reported reflects this.</p><p>This Solution Invalid Warnings table can be silenced by setting <a href="#d37e4fc3-5aa3-4ad3-aa08-5e5a14829a3c" class="moose-modal-link modal-trigger">&quot;allow_invalid_solution&quot;</a> to &#x27;true&#x27;. Then the converged solution will be accepted even if there are still solution invalid warnings, but a message will be generated at the end of the calculation as a reminder:</p><pre class="moose-pre"><code class="language-text">
*** Warning ***
The Solution Invalidity warnings are detected but silenced! Use Problem/allow_invalid_solution=false to activate
</code></pre><p>The Solution Invalid Warning can also be printed out immediately after it is detected by setting <a href="#ae48268d-cc69-44da-bdde-b5aad5f9e686" class="moose-modal-link modal-trigger">&quot;immediately_print_invalid_solution&quot;</a> to <code>true</code>.</p><p></p></section></section><div class="moose-modal modal" id="78e4e1ab-a5b0-4b92-a0a4-a7f039ade335"><div class="modal-content"><h4>(../moose/test/src/materials/NonsafeMaterial.C)</h4><pre class="moose-pre"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;NonsafeMaterial.h&quot;
#include &quot;MooseApp.h&quot;

registerMooseObject(&quot;MooseTestApp&quot;, NonsafeMaterial);

InputParameters
NonsafeMaterial::validParams()
{
  InputParameters params = Material::validParams();

  params.addRequiredParam&lt;Real&gt;(&quot;diffusivity&quot;, &quot;The diffusivity value.&quot;);
  params.addParam&lt;Real&gt;(
      &quot;threshold&quot;,
      0,
      &quot;This value sets the upper limit for the validity of the material property value.&quot;);
  params.addParam&lt;bool&gt;(&quot;test_different_procs&quot;,
                        false,
                        &quot;True to test setting invalid solutions on different processors&quot;);
  params.addParam&lt;bool&gt;(&quot;test_invalid_recover&quot;, false, &quot;True to test invalid solutions recover&quot;);
  params.addParam&lt;Real&gt;(&quot;invalid_after_time&quot;,
                        -std::numeric_limits&lt;Real&gt;::max(),
                        &quot;Only set invalid solutions after this time&quot;);

  return params;
}

NonsafeMaterial::NonsafeMaterial(const InputParameters &amp; parameters)
  : Material(parameters),
    _input_diffusivity(getParam&lt;Real&gt;(&quot;diffusivity&quot;)),
    _threshold(getParam&lt;Real&gt;(&quot;threshold&quot;)),
    _diffusivity(declareProperty&lt;Real&gt;(&quot;diffusivity&quot;)),
    _test_different_procs(getParam&lt;bool&gt;(&quot;test_different_procs&quot;)),
    _test_invalid_recover(getParam&lt;bool&gt;(&quot;test_invalid_recover&quot;)),
    _invalid_after_time(getParam&lt;Real&gt;(&quot;invalid_after_time&quot;))
{
}

void
NonsafeMaterial::computeQpProperties()
{
  Real _test_diffusivity = _input_diffusivity;
  // Gradually modify diffusivity value to test solution invalid recover
  if (_fe_problem.dt() &lt; 1 &amp;&amp; _test_invalid_recover)
    _test_diffusivity /= 2;
  if (_test_diffusivity &gt; _threshold &amp;&amp; _fe_problem.time() &gt; _invalid_after_time)
  {
    if (!_test_different_procs || processor_id() == 0)
      flagInvalidSolution(&quot;The diffusivity is greater than the threshold value!&quot;);
    if (!_test_different_procs || comm().size() == 1 || processor_id() == 1)
      flagInvalidSolution(&quot;Extra invalid thing!&quot;);
  }
  _diffusivity[_qp] = _test_diffusivity;
}
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d37e4fc3-5aa3-4ad3-aa08-5e5a14829a3c"><div class="modal-content"><h4>allow_invalid_solution</h4><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Set to true to allow convergence even though the solution has been marked as 'invalid'</p></div></div><div class="moose-modal modal" id="ae48268d-cc69-44da-bdde-b5aad5f9e686"><div class="modal-content"><h4>immediately_print_invalid_solution</h4><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not to report invalid solution warnings at the time the warning is produced instead of after the calculation</p></div></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="https://cse.google.com/cse.js?cx=008852834041008754713:g3ilnhhbbj9"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>