<!DOCTYPE html><head><meta charset="UTF-8"><title>RelationshipManager | Ferret</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Ferret</a><a href="https://github.com/mangerij/ferret" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="b89bccfb-bcb7-4e0d-858c-dd9e23bb7304" data-constrainWidth="false">Get Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="16f2e1d4-0dac-4995-bf22-ddde8f09e5e5" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="d2f6edca-85ac-4d25-8868-ca1c33d5d89e" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="4f7acf57-e069-40de-b857-10ff53ef920c" data-constrainWidth="false">EU Horizon2020-IF<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../publication_highlights/publication_highlights.html">Highlights</a></li><li><a href="#!" class="dropdown-trigger" data-target="9a764ce5-c61a-4d27-a4db-57b814d98777" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contact</a></li></ul><a href="#" class="sidenav-trigger" data-target="452b9090-e67f-4842-b0fd-49861dc2cb66"><i class="material-icons">menu</i></a><ul class="sidenav" id="452b9090-e67f-4842-b0fd-49861dc2cb66"><li><a href="#!" class="dropdown-trigger" data-target="30003075-006d-496b-8952-014b9f6ad814" data-constrainWidth="false">Get Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="9ebdc987-e54c-4f4e-a5ce-312a5e472e55" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="93d2be08-ee8c-4508-91da-3a9857acf7eb" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="cebd844c-9083-472a-bb8c-3cc26ed85249" data-constrainWidth="false">EU Horizon2020-IF<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../publication_highlights/publication_highlights.html">Highlights</a></li><li><a href="#!" class="dropdown-trigger" data-target="fc031e98-0aa3-459c-97ce-9dc8511346fa" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contact</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="b89bccfb-bcb7-4e0d-858c-dd9e23bb7304"><li><a href="../../getting_started/install.html">Install FERRET</a></li><li><a href="../../getting_started/update.html">Update FERRET</a></li><li><a href="../../getting_started/running.html">Running FERRET</a></li><li><a href="../../getting_started/paraview.html">Visualization Tools</a></li><li><a href="../../getting_started/docs.html">Browse the documentation locally</a></li></ul><ul class="dropdown-content" id="16f2e1d4-0dac-4995-bf22-ddde8f09e5e5"><li><a href="../../theory/intro_LGD.html">Phase Field Method of Ferroelectricity (FE)</a></li><li><a href="../../theory/intro_LLG.html">Micromagnetic Simulations</a></li><li><a href="../../theory/intro_piezo.html">Piezoelectricity</a></li><li><a href="../../theory/intro_thermo.html">Thermoelectric Phenomena</a></li><li><a href="../../theory/intro_optical.html">Optical Properties</a></li></ul><ul class="dropdown-content" id="d2f6edca-85ac-4d25-8868-ca1c33d5d89e"><li><a href="../../tutorials/FE_phase_field_multi_domain.html">Multidomain ferroelectric</a></li><li><a href="../../tutorials/ferroelectric_domain_wall.html">Ferroelectric domain wall</a></li><li><a href="../../tutorials/FE_phase_field_multi_domain_coupled.html">Ferroelectric thin film</a></li><li><a href="../../tutorials/magnetic_ringdown.html">Magnetic ringdown</a></li><li><a href="../../tutorials/AFM_dynamics.html">Antiferromagnetic dynamics</a></li><li><a href="../../tutorials/piezoelectric.html">Piezoelectric actuation</a></li><li><a href="../../tutorials/thermoelectric.html">Polycrystalline thermoelectric transport</a></li></ul><ul class="dropdown-content" id="4f7acf57-e069-40de-b857-10ff53ef920c"><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results1.html">Background and model</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results2.html">Summary of key results</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex1.html">Example (ground states)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex2.html">Example (FE DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex3.html">Example (magnetic DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex4.html">Example (ME switching)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex5.html">Example (spin wave transport)</a></li></ul><ul class="dropdown-content" id="9a764ce5-c61a-4d27-a4db-57b814d98777"><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/ferret_only_syntax.html">FERRET syntax</a></li></ul><ul class="dropdown-content" id="30003075-006d-496b-8952-014b9f6ad814"><li><a href="../../getting_started/install.html">Install FERRET</a></li><li><a href="../../getting_started/update.html">Update FERRET</a></li><li><a href="../../getting_started/running.html">Running FERRET</a></li><li><a href="../../getting_started/paraview.html">Visualization Tools</a></li><li><a href="../../getting_started/docs.html">Browse the documentation locally</a></li></ul><ul class="dropdown-content" id="9ebdc987-e54c-4f4e-a5ce-312a5e472e55"><li><a href="../../theory/intro_LGD.html">Phase Field Method of Ferroelectricity (FE)</a></li><li><a href="../../theory/intro_LLG.html">Micromagnetic Simulations</a></li><li><a href="../../theory/intro_piezo.html">Piezoelectricity</a></li><li><a href="../../theory/intro_thermo.html">Thermoelectric Phenomena</a></li><li><a href="../../theory/intro_optical.html">Optical Properties</a></li></ul><ul class="dropdown-content" id="93d2be08-ee8c-4508-91da-3a9857acf7eb"><li><a href="../../tutorials/FE_phase_field_multi_domain.html">Multidomain ferroelectric</a></li><li><a href="../../tutorials/ferroelectric_domain_wall.html">Ferroelectric domain wall</a></li><li><a href="../../tutorials/FE_phase_field_multi_domain_coupled.html">Ferroelectric thin film</a></li><li><a href="../../tutorials/magnetic_ringdown.html">Magnetic ringdown</a></li><li><a href="../../tutorials/AFM_dynamics.html">Antiferromagnetic dynamics</a></li><li><a href="../../tutorials/piezoelectric.html">Piezoelectric actuation</a></li><li><a href="../../tutorials/thermoelectric.html">Polycrystalline thermoelectric transport</a></li></ul><ul class="dropdown-content" id="cebd844c-9083-472a-bb8c-3cc26ed85249"><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results1.html">Background and model</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_results2.html">Summary of key results</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex1.html">Example (ground states)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex2.html">Example (FE DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex3.html">Example (magnetic DWs)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex4.html">Example (ME switching)</a></li><li><a href="../../MSCA_EU_Horizon2020_Results/horizon2020_ex5.html">Example (spin wave transport)</a></li></ul><ul class="dropdown-content" id="fc031e98-0aa3-459c-97ce-9dc8511346fa"><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/ferret_only_syntax.html">FERRET syntax</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="gcse-search"></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="moose-content col s12 m12 l12"><section id="0f0d3dc6-be41-43df-aeb1-1c8966a4c3e8" data-section-level="1" data-section-text="RelationshipManager"><h1 id="relationshipmanager">RelationshipManager</h1><p>The RelationshipManager system is for making MOOSE aware of extra geometric, algebraic, or coupling information needed to perform a calculation. This is an extension of the &quot;stencil&quot; concept when working with a structured mesh and performing calculations where you need neighboring information. Relationship managers (RMs) come in three flavors: geometric, algebraic, and coupling.  For discerning between the three types, we can think of three levels of &quot;element dependencies&quot;. An element K1 has a coupling dependency on element K2 if the dofs on K1 might need sparsity pattern entries for dofs on K2.  An element K1 has an algebraic dependency on K2 if a processor which owns K1 might need to examine the solution dof values on K2.  An element K1 has a geometric dependency on K2 if a processor which owns K1 might need to examine the geometry of K2. For any element K, we could call the set of coupling-ghosted (&quot;coupled&quot;) elements C(K), call the set of algebraic-ghosted (&quot;evaluable&quot;) elements E(K), and call the set of geometry-ghosted (&quot;ghosted&quot;) elements G(K). It should be safe to assume that, for any element K, C(K) implies E(K) implies G(K), meaning that a requirement for coupling ghosting means that algebraic and geometric ghosting will be required as well. As a more concrete example, it will be impossible to investigate the degrees of freedom on an element in the <code>libMesh::DofMap</code> if that element has been deleted from the current process, e.g. if we forgot to geometrically ghost the element. Hence geometrically ghosted elements must be a super-set of algebraically ghosted elements which must be a super-set of coupling-ghosted elements.</p><p>The RM system is fully pluggable like other MOOSE systems but it not intended to be exposed in the input file in any way. Instead, individual objects that require extra information should &quot;register&quot; an appropriate RM right in its <code>validParams</code> function and have MOOSE add the appropriate object to the simulation at the proper time. It is possible for a single RM to define geometric, algebraic, and coupling-ghosting, e.g like the RM defined for <code>DGKernelBase</code> derived-objects:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(&quot;ElementSideNeighborLayers&quot;,
                              Moose::RelationshipManagerType::GEOMETRIC |
                                  Moose::RelationshipManagerType::ALGEBRAIC |
                                  Moose::RelationshipManagerType::COUPLING);
</code></pre><p>An application developer should always respect the superset relationships discussed in the introductory paragraph, e.g. the following relationship manager additions would provide a valid ghosting set-up:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::GEOMETRIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 3;
    }
);
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::ALGEBRAIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 2;
    }
);
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::COUPLING,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 1;
    }
);
</code></pre><p>because any coupling-ghosted element is guaranteed to be algebraically ghosted, and each algebraically ghosted element is guaranteed to be geometrically ghosted (1 layer coupling ghosting &lt;= 2 layers algebraic ghosting &lt;= 3 layers geometric ghosting). The following set-up is also valid:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(&quot;ElementSideNeighborLayers&quot;,
                              Moose::RelationshipManagerType::GEOMETRIC |
                                  Moose::RelationshipManagerType::ALGEBRAIC |
                                  Moose::RelationshipManagerType::COUPLING);
</code></pre><p>because there is a (default) 1 layer of side ghosting for all ghosting types (1 layer coupling ghosting &lt;= 1 layer algebraic ghosting &lt;= 1 layer geometric ghosting). The following RM set-up would be <em></em>invalid**:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::GEOMETRIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 1;
    }
);
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::ALGEBRAIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 2;
    }
);
</code></pre><p>because there is less geometric ghosting than algebraic. In this scenario we would likely attempt to access degrees of freedom in the solution vector corresponding to elements that had been deleted (in a <code>DistributedMesh</code> context), and our simulation would fail.</p><section id="a7f1da74-7f65-479d-bf54-4d1081fb4602" data-section-level="2" data-section-text="Relationship Managers and Actions"><h2 id="rm_action">Relationship Managers and Actions</h2><p>As explained above, <code>RelationshipManagers</code> are usually added to a simulation through the <code>validParams</code> of <code>MooseObjects</code>. However, during simulation setup, <code>MooseObjects</code> themselves do not add the relationship managers because if they did it would be too late to have any impact on the simulation...remote elements would already be deleted from the mesh because the mesh is prepared way before any <code>MooseObjects</code> are added (other than <code>MeshGenerators</code>). So it is the <code>MooseObjectAction</code> itself that detects whether a <code>MooseObject</code> (through its <code>validParams</code>) has signaled that it needs a relationship manager and adds it. However, if the <code>MooseObjectAction</code> is not adding the <code>MooseObject</code> , and the <code>MooseObject</code> is being added through a custom <code>action</code>, then that custom action has to be responsible for detecting and adding the associated relationship managers. The method that the custom <code>Action</code> should override to add relationship managers is <code>addRelationshipManagers(Moose::RelationshipManagerType input_rm_type)</code>. Both the <code>ContactAction</code> in the contact module, and <code>PorousFlowActionBase</code> in the porous flow module provide examples of overriding this method. </p></section></section></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="https://cse.google.com/cse.js?cx=008852834041008754713:g3ilnhhbbj9"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>